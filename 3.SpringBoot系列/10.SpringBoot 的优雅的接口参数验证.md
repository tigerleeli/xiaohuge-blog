## 1. ä¸ºä»€ä¹ˆéœ€è¦å‚æ•°éªŒè¯

åœ¨åº”ç”¨ç¨‹åºçš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°éœ€è¦ä¿è¯ä¼ å…¥å‚æ•°çš„æ­£ç¡®æ€§çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬åœ¨æ³¨å†Œç”¨æˆ·æ—¶ï¼Œéœ€è¦éªŒè¯ç”¨æˆ·å¡«å†™çš„è¡¨å•æ•°æ®æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œæ˜¯å¦ç¼ºå°‘å¿…å¡«å­—æ®µï¼Œæˆ–è€…æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œç­‰ç­‰ã€‚å¦‚æœä¸å¯¹å‚æ•°è¿›è¡ŒéªŒè¯ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¯èƒ½ä¼šå› æ­¤å—åˆ°æ”»å‡»æˆ–è€…è¿è¡Œå‡ºé”™ã€‚

ä¸ºäº†ä¿è¯å‚æ•°çš„æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å‚æ•°éªŒè¯æœºåˆ¶ï¼Œæ¥æ£€æµ‹å¹¶å¤„ç†ä¼ å…¥çš„å‚æ•°æ ¼å¼æ˜¯å¦ç¬¦åˆè§„èŒƒã€‚

## 2. å¦‚ä½•è¿›è¡Œå‚æ•°éªŒè¯

Spring Bootå†…ç½®äº†ä¸€ä¸ªå¾ˆå¼ºå¤§çš„å‚æ•°éªŒè¯æ¡†æ¶â€”â€”JSR 303 Bean Validation æ ‡å‡†ï¼Œå®ƒå¯ä»¥å¯¹æˆ‘ä»¬çš„å®ä½“ç±»å‚æ•°è¿›è¡Œæ ¡éªŒï¼Œå¹¶ä¸”å¯ä»¥ç»™æˆ‘ä»¬æä¾›è¯¦ç»†çš„é”™è¯¯æç¤ºä¿¡æ¯ã€‚

å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

#### 1. æ·»åŠ ä¾èµ–

åœ¨ `pom.xml` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š

```xml
<!-- æ·»åŠ  JSR-303 Bean Validation ä¾èµ– -->
<dependency>
    <groupId>javax.validation</groupId>
    <artifactId>validation-api</artifactId>
    <version>2.0.1.Final</version>
</dependency>

<!-- Hibernate Validator çš„å®ç° --> 
<dependency>
    <groupId>org.hibernate.validator</groupId>
    <artifactId>hibernate-validator</artifactId>
    <version>6.1.5.Final</version>
</dependency>
```

#### 2. åœ¨å®ä½“ç±»ä¸­æ·»åŠ å‚æ•°éªŒè¯æ³¨è§£

```java
public class User {
    @NotNull(message="ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    private String username;
    
    @NotNull(message="å¯†ç ä¸èƒ½ä¸ºç©º")
    @Size(min=6, max=20, message="å¯†ç é•¿åº¦åº”è¯¥åœ¨6åˆ°20ä½")   
    private String password;
    
    // getter å’Œ setter æ–¹æ³•
}
```

åœ¨å®ä½“ç±»ä¸­ä½¿ç”¨æ³¨è§£ï¼Œå¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œå¯ä»¥æŒ‡å®šå½“å‰å­—æ®µæ˜¯å¦å¯ä»¥ä¸º nullï¼Œä»¥åŠå­—ç¬¦ä¸²çš„é•¿åº¦å’Œæ ¼å¼ç­‰ä¿¡æ¯ï¼Œå¦‚æœä¼ å…¥çš„å‚æ•°ä¸ç¬¦åˆé¢„å®šçš„è§„åˆ™ï¼Œåœ¨æ ¡éªŒæ—¶å°±ä¼šäº§ç”Ÿç›¸åº”çš„æç¤ºã€‚

å¸¸ç”¨çš„å‚æ•°éªŒè¯æ³¨è§£ï¼š

- @NotNullï¼šéªŒè¯æ³¨è§£çš„å…ƒç´ å€¼ä¸ä¸ºnullï¼›
- @NotEmptyï¼šéªŒè¯æ³¨è§£çš„å…ƒç´ å€¼ä¸ä¸ºnullï¼Œä¸”Stringç±»å‹ä¹Ÿä¸ä¸º ""ï¼›
- @NotBlankï¼šéªŒè¯æ³¨è§£çš„å…ƒç´ å€¼ä¸ä¸ºnullï¼Œä¸”å…è®¸å»é™¤ä¸¤ç«¯ç©ºæ ¼åä¸ä¸ºç©ºï¼›
- @Sizeï¼šéªŒè¯æ³¨è§£çš„å…ƒç´ å€¼é•¿åº¦åœ¨minå’ŒmaxèŒƒå›´å†…ï¼›
- @Digitsï¼šéªŒè¯æ³¨è§£å…ƒç´ å€¼çš„æ•´æ•°ä½æ•°å’Œå°æ•°ä½æ•°æ˜¯å¦ç¬¦åˆé¢„æœŸï¼›
- @Rangeï¼šéªŒè¯æ³¨è§£å…ƒç´ å€¼çš„å¤§å°æ˜¯å¦åœ¨æŒ‡å®šèŒƒå›´å†…ï¼›
- @Emailï¼šéªŒè¯æ³¨è§£çš„å…ƒç´ å€¼æ˜¯å¦ä¸ºEmailæ ¼å¼ã€‚

#### 3. åœ¨Controllerä¸­åŠ å…¥å¯¹å‚æ•°çš„éªŒè¯

```java
@RestController
@RequestMapping("/user")
public class UserController {
    
    @PostMapping("/register")
    public CommonResult<User> register(@RequestBody @Validated User user) {
        return CommonResult.success(user);
    }
}
```

åœ¨Controllerå±‚è¿›è¡Œå‚æ•°æ ¡éªŒæ—¶ï¼ŒåŠ ä¸Š `@Validated` æ³¨è§£ä»¥å‘Šè¯‰Springè¿›è¡Œå‚æ•°æ ¡éªŒï¼Œ`@RequestBody` æ³¨è§£ç”¨äºå°†è¯·æ±‚ä½“ä¸­çš„JSONæ•°æ®ç»‘å®šåˆ°å®ä½“ç±»ä¸­ã€‚

#### 4. å®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼Œå¹¶å®šä¹‰è¿”å›ç»“æœCommonResult

```java
@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(value = MethodArgumentNotValidException.class)
    public CommonResult<Object> handleMethodArgumentNotValidException(MethodArgumentNotValidException ex){
        List<ObjectError> errors = ex.getBindingResult().getAllErrors();
        StringBuilder errorMsg = new StringBuilder();
        errors.forEach(error -> errorMsg.append(error.getDefaultMessage()).append("; "));
        return CommonResult.fail(ResultCode.PARAM_VALID_ERROR.getCode(), errorMsg.toString(), null);
    }

    @ExceptionHandler(value = Exception.class)
    public CommonResult<Object> handleException(Exception ex){
        log.error("ç³»ç»Ÿå‘ç”Ÿå¼‚å¸¸ï¼š", ex);
        return CommonResult.fail(ResultCode.SYSTEM_ERROR.getCode(), ResultCode.SYSTEM_ERROR.getMsg(), null);
    }
}
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªå¼‚å¸¸å¤„ç†æ–¹æ³•ï¼Œä¸€ä¸ªå¤„ç† MethodArgumentNotValidException å¼‚å¸¸ï¼Œä¸€ä¸ªå¤„ç†å…¶ä»–ç±»å‹çš„å¼‚å¸¸ï¼Œä½¿ç”¨äº† @ExceptionHandler æ³¨è§£å°†ä¸åŒç±»å‹çš„å¼‚å¸¸æ˜ å°„åˆ°ä¸åŒçš„å¤„ç†æ–¹æ³•ä¸­ã€‚


```java
public enum ResultCode {
    SUCCESS(200, "æ“ä½œæˆåŠŸ"),
    PARAM_VALID_ERROR(400, "å‚æ•°æ ¡éªŒå¤±è´¥"),
    UNAUTHORIZED(401, "æœªè®¤è¯"),
    FORBIDDEN(403, "æ— æƒé™"),
    SYSTEM_ERROR(500, "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯");

    private int code;
    private String msg;

    ResultCode(int code, String msg) {
        this.code = code;
        this.msg = msg;
    }

    public int getCode() {
        return code;
    }

    public String getMsg() {
        return msg;
    }
}

public class CommonResult<T> {
    private int code;
    private String msg;
    private T data;

    public CommonResult() {}

    public CommonResult(int code, String msg, T data) {
        this.code = code;
        this.msg = msg;
        this.data = data;
    }

    public static <T> CommonResult<T> success(T data) {
        return new CommonResult<T>(ResultCode.SUCCESS.getCode(), ResultCode.SUCCESS.getMsg(), data);
    }

    public static <T> CommonResult<T> fail(ResultCode resultCode) {
        return new CommonResult<T>(resultCode.getCode(), resultCode.getMsg(), null);
    }

    public static <T> CommonResult<T> fail(ResultCode resultCode, T data) {
        return new CommonResult<T>(resultCode.getCode(), resultCode.getMsg(), data);
    }

    // getter å’Œ setter æ–¹æ³•
}
```
åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ³›å‹å’Œæšä¸¾ç±»å®šä¹‰å„ç§æ“ä½œè¿”å›çš„æšä¸¾å€¼ï¼Œé€šè¿‡å°è£…è¿”å›å€¼ï¼Œè¿”å›ç»™å‰ç«¯ç»Ÿä¸€çš„è¿”å›æ ¼å¼ï¼Œå‡å°‘é‡å¤ä»£ç ã€‚

#### 5. é€šè¿‡Postmanæ¨¡æ‹Ÿæµ‹è¯•å‚æ•°éªŒè¯

æˆ‘ä»¬å°†è¯·æ±‚æ–¹å¼è®¾ç½®ä¸º POSTï¼Œå¹¶å°†è¯·æ±‚çš„ URL è®¾ç½®ä¸º `http://localhost:8080/user/register`ã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¾ç½®è¯·æ±‚å¤´çš„ Content-Type ä¸º `application/json`ã€‚

æˆ‘ä»¬ä¼ å…¥äº†ä¸€ä¸ªç”¨æˆ·åä¸º `user` ï¼Œå¯†ç ä¸º `123` çš„ç”¨æˆ·å¹¶è¿›è¡Œè¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚åœ¨å‚æ•°æ ¡éªŒçš„è¿‡ç¨‹ä¸­ä¼šå‡ºç°å¼‚å¸¸ã€‚

æœ€ç»ˆçš„æ‰“å°ç»“æœä¸ºï¼š

```json
{
    "code": 400,
    "msg": "å¯†ç é•¿åº¦åº”è¯¥åœ¨6åˆ°20ä½; ",
    "data": null
}
```
## 3.è‡ªå®šä¹‰æ³¨è§£å’ŒéªŒè¯å™¨
åœ¨å®ä½“ç±»ä¸­ä½¿ç”¨æ³¨è§£è¿›è¡Œå‚æ•°éªŒè¯ï¼Œè¿™ç§æ–¹å¼éå¸¸ç®€å•å¿«æ·ï¼Œä½†å¯¹äºä¸€äº›å¤æ‚çš„é€»è¾‘éªŒè¯å¯èƒ½ä¸å¤Ÿçµæ´»ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é‡‡ç”¨ç¼–å†™è‡ªå®šä¹‰æ³¨è§£å’ŒéªŒè¯å™¨çš„æ–¹å¼è¿›è¡Œå‚æ•°éªŒè¯ã€‚

æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™è‡ªå®šä¹‰æ³¨è§£ @Age å’ŒéªŒè¯å™¨ AgeValidatorï¼Œä½¿ç”¨è¿™ä¸¤ä¸ªè‡ªå®šä¹‰ç±»å¯¹è¯·æ±‚å‚æ•°è¿›è¡ŒéªŒè¯ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š
```java
@Target({ElementType.FIELD, ElementType.PARAMETER})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Constraint(validatedBy = {AgeValidator.class})
public @interface Age {
    String message() default "å¹´é¾„ä¸åœ¨åˆæ³•èŒƒå›´å†…";
    int minAge() default 0;
    int maxAge() default 150;
    Class<?>[] groups() default {};
    Class<? extends Payload>[] payload() default {};
}

public class AgeValidator implements ConstraintValidator<Age, Integer> {
    
    private int minAge;
    private int maxAge;

    @Override
    public void initialize(Age constraintAnnotation) {
        this.minAge = constraintAnnotation.minAge();
        this.maxAge = constraintAnnotation.maxAge();
    }

    @Override
    public boolean isValid(Integer value, ConstraintValidatorContext context) {
        if(value == null) {
            return true; // å…è®¸ä¸ºç©ºå€¼
        }
        if(value < minAge || value > maxAge) {
            return false; // éªŒè¯ä¸é€šè¿‡
        }
        return true; // éªŒè¯é€šè¿‡
    }
}

public class User {
    @NotNull(message="ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    private String username;
    
    @Age(message="å¹´é¾„ä¸åœ¨åˆæ³•èŒƒå›´å†…", minAge=0, maxAge=120)
    private Integer age;
    
    // getter å’Œ setter æ–¹æ³•
}
```
å¦‚ä¸Šä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£å’ŒéªŒè¯å™¨è¿›è¡Œå‚æ•°éªŒè¯ï¼Œä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šå¹´é¾„çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œå¹¶ä½¿ç”¨ AgeValidator åœ¨å®ä½“ç±»ä¸­å¯¹å¹´é¾„è¿›è¡ŒéªŒè¯ã€‚

## 4.å°ç»“

ä½¿ç”¨å‚æ•°éªŒè¯æœºåˆ¶å¯ä»¥æœ‰æ•ˆåœ°æé«˜æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å¥å£®æ€§å’Œå®‰å…¨æ€§ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥èŠ‚çœæˆ‘ä»¬è¿›è¡Œå‚æ•°æ ¡éªŒçš„æ—¶é—´å’Œç²¾åŠ›ã€‚Spring Boot å†…ç½®çš„å‚æ•°éªŒè¯æ¡†æ¶ JSR 303 Bean Validation æ ‡å‡†å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®€å•å¿«é€Ÿåœ°å®Œæˆå‚æ•°æ ¡éªŒï¼Œç»“åˆå…¨å±€å¼‚å¸¸å¤„ç†å™¨å’Œè‡ªå®šä¹‰çš„å“åº”ç»“æœç±»ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿåé¦ˆè¯·æ±‚ä¿¡æ¯çš„æ­£ç¡®æ€§ï¼Œå¹¶åœ¨å‡ºç°é”™è¯¯æ—¶æä¾›è¯¦ç»†çš„é”™è¯¯æç¤ºä¿¡æ¯ï¼Œéå¸¸æ–¹ä¾¿å®ç”¨ã€‚

å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼šâ€œå°è™å“¥çš„æŠ€æœ¯åšå®¢â€ã€‚æˆ‘ä»¬ä¼šå®šæœŸå‘å¸ƒå…³äºJavaæŠ€æœ¯çš„è¯¦å°½æ–‡ç« ï¼Œè®©æ‚¨èƒ½å¤Ÿæ·±å…¥äº†è§£è¯¥é¢†åŸŸçš„å„ç§æŠ€å·§å’Œæ–¹æ³•ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æˆä¸ºæ›´ä¼˜ç§€çš„ç¨‹åºå‘˜ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»ï¼

ç›¸å…³æ–‡ç« æºç æ”¾åœ¨ï¼š[giteeä»“åº“](https://gitee.com/cunzaizhe/xiaohuge-blog)ã€[githubä»“åº“](https://github.com/tigerleeli/xiaohuge-blog)ä¸Šã€‚
