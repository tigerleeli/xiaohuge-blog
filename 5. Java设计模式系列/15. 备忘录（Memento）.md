**å¤‡å¿˜å½•ï¼ˆMementoï¼‰æ¨¡å¼æ˜¯ä¸€ç§ç”¨äºå®ç°å¯¹è±¡çŠ¶æ€ä¿å­˜å’Œæ¢å¤çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥å®ç°å¯¹è±¡çŠ¶æ€çš„å¿«ç…§ã€å†å²è®°å½•ç­‰åŠŸèƒ½ã€‚**

## ä»€ä¹ˆæ˜¯å¤‡å¿˜å½•æ¨¡å¼
å¤‡å¿˜å½•æ¨¡å¼å…¶ä¸»è¦æ€æƒ³æ˜¯åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œä¿å­˜å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œä»è€Œå¯ä»¥åœ¨ä¸å½±å“å¯¹è±¡æœ¬èº«çš„æƒ…å†µä¸‹ï¼Œå®ç°å¯¹è±¡çŠ¶æ€çš„ä¿å­˜ã€æ¢å¤ã€å†å²è®°å½•ç­‰åŠŸèƒ½ã€‚å¤‡å¿˜å½•æ¨¡å¼ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªè§’è‰²ï¼šå‘èµ·äººï¼ˆOriginatorï¼‰ã€å¤‡å¿˜å½•ï¼ˆMementoï¼‰å’Œè´Ÿè´£äººï¼ˆCaretakerï¼‰ã€‚

## å¤‡å¿˜å½•æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯

å¤‡å¿˜å½•æ¨¡å¼é€šå¸¸åº”ç”¨äºéœ€è¦å®ç°å¯¹è±¡çŠ¶æ€çš„å†å²è®°å½•ã€æ’¤é”€åŠŸèƒ½ç­‰é¢†åŸŸï¼Œä¾‹å¦‚æ–‡æœ¬ç¼–è¾‘å™¨çš„å†å²è®°å½•åŠŸèƒ½ã€æ¸¸æˆä¸­çš„å­˜æ¡£ç³»ç»Ÿç­‰ã€‚

## å¤‡å¿˜å½•æ¨¡å¼çš„ä»£ç ç¤ºä¾‹

```java
// å®šä¹‰å¤‡å¿˜å½•ç±»
class Memento {
    private String state; // ç”¨äºä¿å­˜çŠ¶æ€ä¿¡æ¯

    public Memento(String state) {
        this.state = state;
    }

    public String getState() {
        return state;
    }
}

// å®šä¹‰å‘èµ·äººç±»
class Originator {
    private String state;

    // ä¿å­˜çŠ¶æ€
    public void setState(String state) {
        this.state = state;
    }

    // åŠ è½½çŠ¶æ€
    public String getState() {
        return state;
    }

    // åˆ›å»ºå¤‡å¿˜å½•
    public Memento createMemento() {
        return new Memento(state);
    }

    // æ¢å¤å¤‡å¿˜å½•
    public void restoreMemento(Memento memento) {
        this.state = memento.getState();
    }
}

// å®šä¹‰è´Ÿè´£äººç±»
class Caretaker {
    private List<Memento> mementoList = new ArrayList<Memento>(); // ç”¨äºä¿å­˜å¤‡å¿˜å½•çš„åˆ—è¡¨

    // æ·»åŠ å¤‡å¿˜å½•
    public void add(Memento state) {
        mementoList.add(state);
    }

    // è·å–å¤‡å¿˜å½•
    public Memento get(int index) {
        return mementoList.get(index);
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class Client {
    public static void main(String[] args) {
        // åˆ›å»ºå‘èµ·äºº
        Originator originator = new Originator();
        // åˆ›å»ºè´Ÿè´£äºº
        Caretaker caretaker = new Caretaker();

        // è®¾ç½®å‘èµ·äººåˆå§‹çŠ¶æ€
        originator.setState("çŠ¶æ€1");
        // ä¿å­˜å½“å‰çŠ¶æ€
        caretaker.add(originator.createMemento());

        // æ›´æ–°çŠ¶æ€
        originator.setState("çŠ¶æ€2");
        // ä¿å­˜å½“å‰çŠ¶æ€
        caretaker.add(originator.createMemento());

        // æ›´æ–°çŠ¶æ€
        originator.setState("çŠ¶æ€3");
        // ä¿å­˜å½“å‰çŠ¶æ€
        caretaker.add(originator.createMemento());

        // æ¢å¤çŠ¶æ€
        originator.restoreMemento(caretaker.get(0));
        System.out.println("æ¢å¤åçš„çŠ¶æ€ï¼š" + originator.getState());

        // æ¢å¤çŠ¶æ€
        originator.restoreMemento(caretaker.get(1));
        System.out.println("æ¢å¤åçš„çŠ¶æ€ï¼š" + originator.getState());

        // æ¢å¤çŠ¶æ€
        originator.restoreMemento(caretaker.get(2));
        System.out.println("æ¢å¤åçš„çŠ¶æ€ï¼š" + originator.getState());
    }
}
```

ä»¥ä¸Šæ˜¯ä¸€ä¸ªåŸºæœ¬çš„å¤‡å¿˜å½•è®¾è®¡æ¨¡å¼çš„ä»£ç ç¤ºä¾‹ï¼Œå…¶ä¸­ Memento ç±»è´Ÿè´£ä¿å­˜å‘èµ·äºº Originator çš„çŠ¶æ€ï¼›Originator è´Ÿè´£åˆ›å»ºå¤‡å¿˜å½•å’Œæ¢å¤çŠ¶æ€ï¼›Caretaker è´Ÿè´£ä¿å­˜å’Œè·å–å¤‡å¿˜å½•ã€‚

åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡é¢‘ç¹ä¿®æ”¹ Originator å¯¹è±¡çš„çŠ¶æ€ï¼Œç„¶åé€šè¿‡ createMemento æ–¹æ³•ä¿å­˜çŠ¶æ€ï¼Œå¹¶å°†å¤‡å¿˜å½•å¯¹è±¡æ·»åŠ åˆ° Caretaker ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°å¤‡å¿˜å½•æ¨¡å¼ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡æ¢å¤æ“ä½œå°†çŠ¶æ€æ¢å¤åˆ°å¤‡å¿˜å½•ä¸­æ‰€ä¿å­˜çš„çŠ¶æ€ã€‚

ä»¥ä¸Šä»£ç çš„ç»“æœä¸ºï¼š

```
æ¢å¤åçš„çŠ¶æ€ï¼šçŠ¶æ€1
æ¢å¤åçš„çŠ¶æ€ï¼šçŠ¶æ€2
æ¢å¤åçš„çŠ¶æ€ï¼šçŠ¶æ€3
```

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å°† Originator å¯¹è±¡çš„çŠ¶æ€ä» "çŠ¶æ€1" åˆ° "çŠ¶æ€2" å†åˆ° "çŠ¶æ€3" è¿›è¡Œäº†å¤šæ¬¡ä¿®æ”¹ï¼Œå¹¶å°†æ¯æ¬¡çš„çŠ¶æ€ä¿å­˜åˆ°å¤‡å¿˜å½•ä¸­ã€‚åœ¨æ¢å¤çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬ä» Caretaker ä¸­è·å–å¤‡å¿˜å½•å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ Originator çš„ restoreMemento æ–¹æ³•å°†çŠ¶æ€æ¢å¤åˆ°å¯¹åº”å¤‡å¿˜å½•ä¸­æ‰€ä¿å­˜çš„çŠ¶æ€ã€‚

å› æ­¤ï¼Œå®¢æˆ·ç«¯è¿è¡Œç»“æœæŒ‰é¡ºåºè¾“å‡ºäº†ä¸‰ä¸ªçŠ¶æ€çš„æ¢å¤ç»“æœï¼Œåˆ†åˆ«ä¸º "çŠ¶æ€1"ã€"çŠ¶æ€2" å’Œ "çŠ¶æ€3"ã€‚

è¿™ä¸ªç¤ºä¾‹è™½ç„¶ç®€å•ï¼Œä½†æ˜¯æ¯”è¾ƒæ¸…æ™°åœ°å±•ç¤ºäº†å¤‡å¿˜å½•æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³ã€‚å¤‡å¿˜å½•æ¨¡å¼é€‚ç”¨äºä¿å­˜å¯¹è±¡å†å²è®°å½•ã€æä¾›æ¢å¤æ•°æ®çš„åœºåˆï¼Œå…·æœ‰å¾ˆå¥½çš„æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è®¾è®¡æ¨¡å¼ã€‚

## å¤‡å¿˜å½•æ¨¡å¼çš„å®é™…åº”ç”¨

1. Javaä¸­çš„UndoManagerï¼šJavaä¸­çš„UndoManagerç±»æ˜¯ç”¨æ¥ç®¡ç†æ’¤é”€ã€æ¢å¤æ“ä½œçš„ç±»ï¼Œå®ç°äº†å¤‡å¿˜å½•æ¨¡å¼ï¼Œå®ƒåˆ©ç”¨äº†æ ˆæ¥ä¿å­˜Commandsæ“ä½œï¼Œåˆ©ç”¨äº†å¤‡å¿˜å½•æ¨¡å¼ä¸­çš„ä¿å­˜å†å²çŠ¶æ€ç­‰åŠŸèƒ½ã€‚

2. Androidä¸­çš„onSaveInstanceState/onRestoreInstanceStateï¼šåœ¨Androidå¹³å°ä¸­ï¼Œé€šè¿‡å®ç° onSaveInstanceState/onRestoreInstanceState æ–¹æ³•ï¼Œå¯ä»¥ä¿å­˜å’Œæ¢å¤Activityçš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶ä¸”éšæ—¶å–å‡ºç›¸å…³æ•°æ®ã€‚è¿™ä¸ªåŠŸèƒ½ä¹Ÿæ˜¯åŸºäºå¤‡å¿˜å½•æ¨¡å¼å®ç°çš„ã€‚

## æ€»ç»“
å¤‡å¿˜å½•æ¨¡å¼æ˜¯ä¸€ç§ç”¨äºå®ç°å¯¹è±¡çŠ¶æ€ä¿å­˜å’Œæ¢å¤çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥åœ¨ä¸ç ´åå¯¹è±¡å°è£…æ€§çš„å‰æä¸‹ï¼Œå°†å¯¹è±¡çŠ¶æ€ä¿å­˜åˆ°å¤‡å¿˜å½•å¯¹è±¡ä¸­ã€‚å¤‡å¿˜å½•æ¨¡å¼é€‚ç”¨äºéœ€è¦å®ç°å¯¹è±¡å†å²è®°å½•ã€æ’¤é”€æ“ä½œç­‰åŠŸèƒ½çš„åœºæ™¯ã€‚è¯¥æ¨¡å¼çš„æ ¸å¿ƒæ˜¯å¤‡å¿˜å½•ç±»ï¼Œç”¨äºä¿å­˜å¯¹è±¡çŠ¶æ€ï¼›å‘èµ·äººç±»åˆ™æ˜¯ä¿å­˜å’Œæ¢å¤çŠ¶æ€çš„å¯¹è±¡ï¼›è´Ÿè´£äººç±»åˆ™æ˜¯è´Ÿè´£ç®¡ç†å¤‡å¿˜å½•å¯¹è±¡ã€‚å¤‡å¿˜å½•æ¨¡å¼å…·æœ‰å¾ˆå¥½çš„æ‰©å±•æ€§ï¼Œå¯ä»¥é€šè¿‡ç»§æ‰¿å’Œå®ç°æ¥å£æ¥å¢åŠ åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¸å…¶ä»–æ¨¡å¼è¿›è¡Œç»“åˆä½¿ç”¨ã€‚

å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼šâ€œå°è™å“¥çš„æŠ€æœ¯åšå®¢â€ã€‚æˆ‘ä»¬ä¼šå®šæœŸå‘å¸ƒå…³äºJavaæŠ€æœ¯çš„è¯¦å°½æ–‡ç« ï¼Œè®©æ‚¨èƒ½å¤Ÿæ·±å…¥äº†è§£è¯¥é¢†åŸŸçš„å„ç§æŠ€å·§å’Œæ–¹æ³•ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æˆä¸ºæ›´ä¼˜ç§€çš„ç¨‹åºå‘˜ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»ï¼