## 1. ä»€ä¹ˆæ˜¯ Spring Data JPA

Spring Data JPA æ˜¯ Spring å¯¹ JPA è§„èŒƒçš„å°è£…ï¼Œç®€åŒ–äº† JPA çš„ä½¿ç”¨ï¼Œæä¾›äº†æ›´åŠ æ–¹ä¾¿çš„æ•°æ®è®¿é—®å±‚ APIã€‚ç›¸å¯¹äºå¸¸è§„çš„ JPA ä»£ç ï¼ŒSpring Data JPA ä»£ç æ›´ç®€æ´ã€æ›´æ˜“äºç»´æŠ¤ã€‚

JPAå…¨ç§°Java Persistence APIï¼ˆJavaæŒä¹…åŒ–æ¥å£ï¼‰ã€‚

## 2. SpringBoot é›†æˆ Spring Data JPA çš„æ­¥éª¤

ä¸‹é¢ä»‹ç»ä½¿ç”¨ SpringBoot é›†æˆ Spring Data JPA çš„æ­¥éª¤ã€‚

### 2.1 å¼•å…¥ä¾èµ–

åœ¨ SpringBoot ä¸­ï¼Œå¯ä»¥é€šè¿‡åœ¨ `pom.xml` æ–‡ä»¶ä¸­å¼•å…¥ Spring Data JPA çš„ä¾èµ–æ¥ä½¿ç”¨ã€‚åœ¨ `pom.xml` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.3.2.RELEASE</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>

    <modelVersion>4.0.0</modelVersion>
    <groupId>com.example</groupId>
    <artifactId>demo</artifactId>
    <version>1.0.0</version>
    <name>demo</name>
    <description>demo</description>

    <dependencies>
        <!-- SpringBoot å’Œ Spring Data JPA ä¾èµ– -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>
 
        <!-- MySQL æ•°æ®åº“ä¾èµ– -->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <scope>runtime</scope>
        </dependency>
 
        <!-- SpringBoot Web ä¾èµ–-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
    </dependencies>

</project>

```

### 2.2 é…ç½®æ•°æ®æº

åœ¨ä½¿ç”¨ Spring Data JPA ä¹‹å‰ï¼Œéœ€è¦å…ˆé…ç½®å¥½æ•°æ®åº“å’Œæ•°æ®æºã€‚å¯ä»¥åœ¨ `application.properties` ä¸­é…ç½®æ•°æ®æºï¼Œä¾‹å¦‚ï¼š

```
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/db_name
spring.datasource.username=root
spring.datasource.password=password
```

### 2.3 åˆ›å»ºå®ä½“ç±»

åœ¨ä½¿ç”¨ Spring Data JPA è¿›è¡Œæ•°æ®æ“ä½œæ—¶ï¼Œéœ€è¦å…ˆå®šä¹‰å®ä½“ç±»ã€‚å®ä½“ç±»ä¸­éœ€è¦ä½¿ç”¨æ³¨è§£ `@Entity` æ ‡è®°è¯¥ç±»ä¸ºå®ä½“ç±»ï¼Œå¹¶ä½¿ç”¨ `@Id` å’Œ `@GeneratedValue` æ ‡è®°ä¸»é”®ã€‚ä¾‹å¦‚ï¼š

```java
@Entity
public class User {
    @Id
    @GeneratedValue
    private Long id;
    private String name;
    private Integer age;
    // çœç•¥ getter å’Œ setter æ–¹æ³•
}
```

### 2.4 åˆ›å»º DAO æ¥å£

åœ¨ Spring Data JPA ä¸­ï¼Œä¸éœ€è¦è‡ªå·±ç¼–å†™ DAO å±‚çš„å®ç°ç±»ï¼Œåªéœ€è¦å®šä¹‰DAOæ¥å£å¹¶ç»§æ‰¿ `JpaRepository` æˆ–è€… `PagingAndSortingRepository` æ¥å£å°±å¯ä»¥äº†ã€‚ä¾‹å¦‚ï¼š

```java
public interface UserRepository extends JpaRepository<User, Long> {
}
```

`JpaRepository` æ¥å£ä¸­æä¾›äº†è®¸å¤šåŸºæœ¬çš„æ•°æ®æ“ä½œæ–¹æ³•ï¼Œä¾‹å¦‚ saveã€deleteã€findAll ç­‰æ“ä½œã€‚è€Œ `PagingAndSortingRepository` æ¥å£é™¤äº†ç»§æ‰¿äº† `JpaRepository` æ¥å£çš„æ–¹æ³•å¤–ï¼Œè¿˜æä¾›äº†æ’åºå’Œåˆ†é¡µæŸ¥è¯¢çš„æ–¹æ³•ã€‚

### 2.5 ä¸šåŠ¡é€»è¾‘å±‚

åœ¨ä¸šåŠ¡é€»è¾‘å±‚ä¸­æ³¨å…¥ DAO æ¥å£ï¼Œè°ƒç”¨ DAO æ–¹æ³•è¿›è¡Œæ•°æ®æ“ä½œã€‚ä¾‹å¦‚ï¼š

```java
@Service
public class UserServiceImpl implements UserService {
    @Autowired
    private UserRepository userRepository;

    // æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
    @Override
    public List<User> listUsers() {
        return userRepository.findAll();
    }

    // æ–°å¢ç”¨æˆ·
    @Override
    public void saveUser(User user) {
        userRepository.save(user);
    }

    // ä¿®æ”¹ç”¨æˆ·
    @Override
    public void updateUser(User user) {
        userRepository.save(user);
    }

    // åˆ é™¤ç”¨æˆ·
    @Override
    public void deleteUser(Long id) {
        userRepository.deleteById(id);
    }

    // æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·
    @Override
    public User getUserById(Long id) {
        return userRepository.getOne(id);
    }
}
```

### 2.6 Controller å±‚

åœ¨ Controller å±‚ä½¿ç”¨ä¸šåŠ¡é€»è¾‘å±‚æä¾›çš„æ–¹æ³•è¿›è¡Œæ•°æ®æ“ä½œï¼Œä¾‹å¦‚ï¼š

```java
@RestController
public class UserController {
    @Autowired
    private UserService userService;

    // æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
    @GetMapping("/users")
    public List<User> listUsers() {
        return userService.listUsers();
    }

    // æ–°å¢ç”¨æˆ·
    @PostMapping("/users")
    public void saveUser(@RequestBody User user) {
        userService.saveUser(user);
    }

    // ä¿®æ”¹ç”¨æˆ·
    @PutMapping("/users")
    public void updateUser(@RequestBody User user) {
        userService.updateUser(user);
    }

    // åˆ é™¤ç”¨æˆ·
    @DeleteMapping("/users/{id}")
    public void deleteUser(@PathVariable("id") Long id) {
        userService.deleteUser(id);
    }

    // æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·
    @GetMapping("/users/{id}")
    public User getUserById(@PathVariable("id") Long id) {
        return userService.getUserById(id);
    }
}
```

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ Controller å±‚ä¸­è°ƒç”¨äº†ä¸šåŠ¡é€»è¾‘å±‚æä¾›çš„æ–¹æ³•è¿›è¡Œæ•°æ®æ“ä½œã€‚

åˆ°æ­¤ï¼Œå°±å®Œæˆäº† SpringBoot é›†æˆ Spring Data JPA çš„æ“ä½œã€‚

## 3. æ€»ç»“

Spring Data JPA ç®€åŒ–äº† JPA çš„ä½¿ç”¨ï¼Œæä¾›äº†æ›´æ–¹ä¾¿çš„æ•°æ®è®¿é—®å±‚ APIï¼Œä½¿å¾—æ•°æ®æ“ä½œæ›´åŠ ç®€æ´ã€æ˜“äºç»´æŠ¤ã€‚é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæˆ‘ä»¬ä»‹ç»äº† SpringBoot é›†æˆ Spring Data JPA çš„æ­¥éª¤ï¼ŒåŒ…æ‹¬ä¾èµ–å¼•å…¥ã€æ•°æ®æºé…ç½®ã€å®ä½“ç±»å®šä¹‰ã€DAO æ¥å£å®šä¹‰ã€ä¸šåŠ¡é€»è¾‘å±‚å’Œ Controller å±‚çš„ç¼–å†™ã€‚

å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼šâ€œå°è™å“¥çš„æŠ€æœ¯åšå®¢â€ã€‚æˆ‘ä»¬ä¼šå®šæœŸå‘å¸ƒå…³äºJavaæŠ€æœ¯çš„è¯¦å°½æ–‡ç« ï¼Œè®©æ‚¨èƒ½å¤Ÿæ·±å…¥äº†è§£è¯¥é¢†åŸŸçš„å„ç§æŠ€å·§å’Œæ–¹æ³•ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æˆä¸ºæ›´ä¼˜ç§€çš„ç¨‹åºå‘˜ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»ï¼

![](/images/Common/wx.png)