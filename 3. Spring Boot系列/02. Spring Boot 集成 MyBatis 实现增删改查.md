å½“ä½ ä½¿ç”¨ Spring Boot æ¥å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼ŒMyBatis æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„æŒä¹…å±‚æ¡†æ¶ï¼Œè¿™ç¯‡æ•™ç¨‹å°†å¸®åŠ©æ‚¨å­¦ä¹ å¦‚ä½•åœ¨ Spring Boot ä¸­é›†æˆ MyBatisï¼Œå®ç°åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚ æˆ‘ä»¬ä»¥ä¸€ä¸ªç”¨æˆ·è¡¨ä¸ºä¾‹ã€‚

### åˆ›å»ºé¡¹ç›®å’Œæ•°æ®åº“

é¦–å…ˆï¼Œæ‚¨éœ€è¦ä¸‹è½½å¹¶å®‰è£… MySQL æ•°æ®åº“ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåä¸º `userdb` çš„æ•°æ®åº“ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåä¸º `user` çš„ç”¨æˆ·è¡¨ï¼Œå­—æ®µå¦‚ä¸‹ï¼š

```sql
CREATE TABLE user (
  id          INT PRIMARY KEY AUTO_INCREMENT,
  name        VARCHAR(64) NOT NULL,
  age         INT,
  email       VARCHAR(128),
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

åŒæ—¶ï¼Œæ‚¨è¿˜éœ€è¦ä½¿ç”¨ Spring Initializr åˆ›å»ºä¸€ä¸ªæ–°çš„ Maven é¡¹ç›®ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä¾èµ–é¡¹ï¼š

```xml
<dependencies>
  <!-- Spring Boot ç›¸å…³ä¾èµ– -->
  <dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
  </dependency>
  <dependency>
    <groupId>org.mybatis.spring.boot</groupId>
    <artifactId>mybatis-spring-boot-starter</artifactId>
    <version>2.2.0</version>
  </dependency>
  <dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
  </dependency>
</dependencies>
```

### åˆ›å»ºå®ä½“ç±»

å…¶æ¬¡ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªç”¨æˆ·å®ä½“ç±»ï¼Œç”¨äºæè¿°ç”¨æˆ·å¯¹è±¡ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```java
@Data
public class User {
    private Long id;
    private String name;
    private Integer age;
    private String email;
    private LocalDateTime createTime;
    private LocalDateTime updateTime;
}
```

### åˆ›å»º Mapper æ¥å£

æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ª Mapper æ¥å£ï¼Œç”¨äºå®šä¹‰å¯¹ç”¨æˆ·è¡¨çš„æ•°æ®åº“æ“ä½œã€‚æˆ‘ä»¬å°†å±•ç¤ºä¸¤ç§å®šä¹‰sqlè¯­å¥çš„æ–¹å¼:æ³¨è§£å’Œxmlã€‚

#### ä½¿ç”¨æ³¨è§£å®šä¹‰ SQL è¯­å¥

åœ¨è¯¥æ¥å£ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ MyBatis çš„æ³¨è§£æ¥æ˜ å°„ SQL è¯­å¥ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```java
@Mapper
public interface UserMapper {
    @Insert("INSERT INTO user(name, age, email, create_time, update_time) VALUES(#{name}, #{age}, #{email}, now(),now())")
    int insert(User user);

    @Select("SELECT * FROM user")
    List<User> selectAll();

    @Select("SELECT * FROM user WHERE id = #{id}")
    User selectById(Long id);

    @Delete("DELETE FROM user WHERE id = #{id}")
    int deleteById(Long id);

    @Update("UPDATE user SET name=#{name}, age=#{age}, email=#{email}, update_time=now() WHERE id = #{id}")
        int updateById(User user);
}
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ MyBatis çš„æ³¨è§£æ¥å®šä¹‰äº†äº”ä¸ªæ–¹æ³•ï¼š

- insertï¼šç”¨äºå‘ç”¨æˆ·è¡¨ä¸­æ’å…¥ä¸€æ¡è®°å½•
- selectAllï¼šç”¨äºæŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·è®°å½•
- selectByIdï¼šç”¨äºæ ¹æ®ç”¨æˆ· ID æŸ¥è¯¢ä¸€æ¡è®°å½•
- deleteByIdï¼šåˆ é™¤æŒ‡å®š ID çš„ç”¨æˆ·è®°å½•
- updateByIdï¼šæ ¹æ® ID æ›´æ–°æŒ‡å®šç”¨æˆ·è®°å½•

#### ä½¿ç”¨ XML æ–¹å¼å®šä¹‰ SQL è¯­å¥

å¦å¤–ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ XML æ–¹å¼æ¥å®šä¹‰ SQL è¯­å¥ï¼Œéœ€è¦åœ¨ resources ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªåä¸º `mapper` çš„å­ç›®å½•ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªåä¸º `UserMapper.xml` çš„æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰ SQL è¯­å¥ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ mapper æ–‡ä»¶ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.springbootmybatis.mapper.UserMapper">
    <resultMap id="userMap" type="com.example.springbootmybatis.entity.User">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="age" column="age"/>
        <result property="email" column="email"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <insert id="insert" parameterType="com.example.springbootmybatis.entity.User">
        INSERT INTO user(name, age, email, create_time, update_time)
        VALUES(#{name}, #{age}, #{email}, now(),now())
    </insert>

    <select id="selectAll" resultMap="userMap">
        SELECT * FROM user
    </select>

    <select id="selectById" resultMap="userMap" parameterType="long">
        SELECT * FROM user WHERE id = #{id}
    </select>

    <delete id="deleteById" parameterType="long">
        DELETE FROM user WHERE id = #{id}
    </delete>

    <update id="updateById" parameterType="com.example.springbootmybatis.entity.User">
        UPDATE user SET name=#{name}, age=#{age}, email=#{email}, update_time=now() WHERE id = #{id}
    </update>
</mapper>
```

### é…ç½® MyBatis å’Œæ•°æ®æº

ä¸ºäº†è¿æ¥ MyBatis å’Œæ•°æ®æºï¼Œæˆ‘ä»¬éœ€è¦åœ¨ application.properties æ–‡ä»¶ä¸­é…ç½® MyBatis å’Œæ•°æ®æºã€‚æ³¨æ„ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Spring Boot é»˜è®¤çš„æ•°æ®æº HikariCP, ä¸éœ€è¦é¢å¤–å»æ·»åŠ æ•°æ®åº“è¿æ¥æ± ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```properties
# é…ç½® MyBatis
mybatis.type-aliases-package=com.example.springbootmybatis.entity
mybatis.mapper-locations=classpath:mapper/*.xml
```

### é…ç½®æ‰«æå™¨

æœ€åï¼Œæˆ‘ä»¬æ¥é…ç½®æ‰«æå™¨ï¼Œæ‰«æ Mapper æ¥å£å¹¶å°†å…¶æ³¨å†Œåˆ° Spring ä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```java
@Configuration
@MapperScan("com.example.springbootmybatis.mapper")
public class DataSourceConfig {
    @Bean
    @ConfigurationProperties("spring.datasource")
    public DataSource dataSource() {
        return new HikariDataSource();
    }
}
```

åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† @MapperScan æ³¨è§£æ¥æ‰«æ Mapper æ¥å£ï¼Œå¹¶å°†å…¶æ³¨å†Œåˆ° Spring ä¸­ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨äº† @ConfigurationProperties æ³¨è§£æ¥è¯»å– application.properties æ–‡ä»¶ä¸­çš„æ•°æ®æºé…ç½®ä¿¡æ¯ï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ°æ•°æ®æºå¯¹è±¡ä¸­ã€‚

### æµ‹è¯•

æœ€åï¼Œæ‚¨éœ€è¦ç¼–å†™ä¸€ä¸ªç®€å•çš„æ§åˆ¶å™¨ç±»æ¥æµ‹è¯•åº”ç”¨ç¨‹åºæ˜¯å¦æ­£å¸¸è¿è¡Œã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```java
@RestController
public class UserController {
    @Autowired
    private UserMapper userMapper;

    @GetMapping("/users")
    public List<User> getUsers() {
        return userMapper.selectAll();
    }

    @PostMapping("/users")
    public int addUser(@RequestBody User user) {
        return userMapper.insert(user);
    }

    @GetMapping("/users/{id}")
    public User getUserById(@PathVariable Long id) {
        return userMapper.selectById(id);
    }

    @PutMapping("/users/{id}")
    public int updateUserById(@PathVariable Long id, @RequestBody User user) {
        user.setId(id);
        return userMapper.updateById(user);
    }

    @DeleteMapping("/users/{id}")
    public int deleteUserById(@PathVariable Long id) {
        return userMapper.deleteById(id);
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º UserController çš„æ§åˆ¶å™¨ç±»ï¼Œä½¿ç”¨å„ç§ HTTP æ–¹æ³•å®ç°äº†æ·»åŠ ã€åˆ é™¤ã€æŸ¥è¯¢ç”¨æˆ·æ“ä½œã€‚åœ¨æ¯ä¸ªæ–¹æ³•çš„æ–¹æ³•ä½“ä¸­è°ƒç”¨äº†å¯¹åº”çš„ Mapper æ–¹æ³•ã€‚

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†åŸºäºSpring Boot æ¡†æ¶é›†æˆ MyBatis å®ç°å¢åˆ æ”¹æŸ¥ çš„æ•™ç¨‹ï¼ŒåŒ…æ‹¬ä½¿ç”¨æ³¨è§£å’Œ XML æ–¹å¼å®šä¹‰ SQL è¯­å¥ä»¥åŠä½¿ç”¨ Spring Boot é»˜è®¤çš„æ•°æ®åº“è¿æ¥æ± ã€‚é€šè¿‡è¯¥æ•™ç¨‹ï¼Œåˆå­¦è€…å¯ä»¥å¿«é€Ÿäº†è§£ Spring Boot é›†æˆ Mybatis çš„åŸºæœ¬çŸ¥è¯†ã€‚

### æ€»ç»“

MyBatisæ˜¯åŸºäºJavaçš„æŒä¹…åŒ–æ¡†æ¶ï¼Œé€šè¿‡XMLæˆ–æ³¨è§£çš„æ–¹å¼å°†SQLè¯­å¥æ˜ å°„ä¸ºJavaæ–¹æ³•ï¼Œä»è€Œå®ç°äº†å¯¹æ•°æ®åº“çš„çµæ´»æ“ä½œã€‚MyBatisä¸Hibernateç›¸æ¯”ï¼Œå…¶è½»é‡çº§ã€åŠè‡ªåŠ¨åŒ–çš„ç‰¹ç‚¹ä½¿å¾—å¼€å‘æ›´åŠ çµæ´»ã€‚MyBatis ä¸ Spring Boot é›†æˆï¼Œå¯ä»¥é€šè¿‡æ³¨è§£æˆ– XML ç­‰æ–¹å¼ï¼Œè½»æ¾å®ç°å¸¸è§„çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚åŒæ—¶é€šè¿‡ MyBatis å¯ä»¥ä½¿ç”¨é€šç”¨ Mapper æ¥ç®€åŒ– DAO å±‚ä»£ç ã€‚æ‰€ä»¥ MyBatis æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„æŒä¹…å±‚æ¡†æ¶ã€‚

å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼šâ€œå°è™å“¥çš„æŠ€æœ¯åšå®¢â€ã€‚æˆ‘ä»¬ä¼šå®šæœŸå‘å¸ƒå…³äºJavaæŠ€æœ¯çš„è¯¦å°½æ–‡ç« ï¼Œè®©æ‚¨èƒ½å¤Ÿæ·±å…¥äº†è§£è¯¥é¢†åŸŸçš„å„ç§æŠ€å·§å’Œæ–¹æ³•ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æˆä¸ºæ›´ä¼˜ç§€çš„ç¨‹åºå‘˜ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»ï¼

![](/images/Common/wx.png)